# Асинхронность в JavaScript

## Определение
Асинхронность — способ выполнять отложенные задачи без блокировки основного потока выполнения (JavaScript работает в однопоточном движке).

В асинхронной модели задачи могут выполняться "в фоне", пока основной код продолжает работу.

---

## Для чего используется
- Отложенное выполнение кода
- Обработка событий
- Таймеры и планирование задач
- Работа с сетевыми запросами (HTTP, WebSocket)
- Реакция на действия пользователя
- Работа с файлами, базами данных и API

---

## Как работает
1. **JavaScript однопоточен** — выполняет код поочерёдно.
2. **Асинхронность реализуется через Event Loop** — механизм, который управляет выполнением задач.
3. Асинхронный код попадает в **очереди задач**:
   - **Macrotask Queue** (основная очередь)
   - **Microtask Queue** (очередь микрозадач)
4. Код из очередей выполняется **после освобождения Call Stack** (стека вызовов).

---
## Основные инструменты

| <center>Конспект</center>                  | Описание                                                      | Статус |
| ------------------------------------------ | ------------------------------------------------------------- | ------ |
| [[Асинхронность - Event Loop]]             | Управляет порядком выполнения синхронных и асинхронных задач. |        |
| [[Асинхронность - setTimeout]]             | Выполняет код с задержкой.                                    | ✅      |
| [[Асинхронность - setInterval]]            | Повторяет код через заданный интервал.                        | ✅      |
| [[Асинхронность - Promise]]                | Представляет результат асинхронной операции.                  | ✅      |
| [[Асинхронность - async await]]            | Упрощает работу с Promise в синхронном стиле.                 |        |
| [[Асинхронность - requestAnimationFrame]]  | Запускает код перед перерисовкой экрана.                      |        |
| [[Асинхронность - Microtask vs Macrotask]] | Делит задачи на микрозадачи и макрозадачи.                    |        |

---

## Ключевые понятия
- **Call Stack** — стек вызовов, в котором выполняется код.
- **Event Loop** — цикл событий, следящий за очередями задач.
- **Task Queue (Macrotask Queue)** — очередь макрозадач (таймеры, события, I/O).
- **Microtask Queue** — очередь микрозадач (Promise, queueMicrotask).

---

## Визуальная схема Event Loop
```mermaid
graph TD
    A[Вызов кода] --> B[Call Stack]
    B -->|Асинхронная задача| C[Web APIs]
    C -->|Готово| D[Task Queue]
    C -->|Микрозадача| E[Microtask Queue]
    D -->|После стека| B
    E -->|До макрозадач| B
```




```mermaid
sequenceDiagram
    autonumber
    participant User as Пользователь
    participant JS as JS (Call Stack)

    User->>JS: Клик "Отправить комментарий"
    JS->>JS: Выполнение сетевого запроса
    Note over JS: Интерфейс заблокирован
    JS-->>User: Ответ получен • Обновление UI
```


```mermaid
sequenceDiagram
    autonumber
    participant User as Пользователь
    participant JS as JS (Call Stack)
    participant API as Web API / Node API

    User->>JS: Клик "Отправить комментарий"
    JS->>API: Старт сетевого запроса (не блокирует)
    JS-->>User: Открытие сайдбара (реакция на клик)
    API-->>JS: Ответ готов
    JS-->>User: Обработка ответа через Event Loop • Обновление UI
```



```mermaid
flowchart TD
    A[Синхронный код / Call Stack] -->|Инициирует| B[Web APIs или Node APIs]
    B -->|Готово| C[Macrotask Queue: setTimeout, IO, события]
    B -->|Готово| D[Microtask Queue: Promise, queueMicrotask]
    E[Event Loop] -->|Если стек пуст| D
    E -->|После микрозадач| C
    D --> A
    C --> A
```
