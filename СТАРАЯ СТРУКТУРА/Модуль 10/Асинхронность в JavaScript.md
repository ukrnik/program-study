# 📌 Промисы в JavaScript — полное, но простое объяснение

## 🔹 Что такое промис?

**Promise** — это объект, представляющий результат **асинхронной операции**, которая может завершиться **успешно или с ошибкой**.

> Пример: ты заказал торт у Полли.  
> Если всё хорошо — торт будет (`fulfilled`).  
> Если Полли заболела — торта не будет (`rejected`).  
> Пока не ясно — мы **ждём** (`pending`).

---

## 🔹 Состояния промиса

| Состояние   | Описание                       |
|-------------|--------------------------------|
| `pending`   | Ожидание (начальное состояние) |
| `fulfilled` | Успешно выполнено              |
| `rejected`  | Завершено с ошибкой            |

✅ После `fulfilled` или `rejected` промис считается **settled** (завершённый), и его состояние больше не меняется.

---

## 🔹 Как работает промис: схема

```
            Создание промиса
                  ↓
┌─────────────────────────────────────────────┐
│ new Promise((resolve, reject) => {          │
│   // Асинхронная операция                   │
│   если всё хорошо → resolve(value)          │
│   если ошибка       → reject(error)         │
└─────────────────────────────────────────────┘
                  ↓
          Промис в состоянии:
          ┌────────────┐
          │  pending   │ ← ожидание
          └────────────┘
                │
     ┌──────────┴───────────┐
     ↓                      ↓
┌────────────┐       ┌────────────┐
│ fulfilled  │       │  rejected  │
│ (успех)    │       │ (ошибка)   │
└────────────┘       └────────────┘
     ↓                      ↓
.then(value => {     .catch(error => {
  ...код...             ...код...
})                     })
```

---

## 🔹 Создание промиса

```js
const promise = new Promise((resolve, reject) => {
  // Асинхронная операция
  if (успешно) {
    resolve("Успешный результат");
  } else {
    reject("Произошла ошибка");
  }
});
```

- ✅ `resolve(value)` — вызывает успех
- ❌ `reject(error)` — вызывает ошибку

> `resolve` и `reject` — это функции, **автоматически передаваемые** в твой колбэк. Их можно назвать как угодно, но по умолчанию лучше оставить стандартные имена.

---

## 🔹 Обработка результата

```js
promise
  .then(result => {
    console.log("✅", result);
  })
  .catch(error => {
    console.error("❌", error);
  })
  .finally(() => {
    console.log("🔚 Промис завершён");
  });
```

- `then()` — обработка результата (`fulfilled`)
- `catch()` — обработка ошибки (`rejected`)
- `finally()` — выполняется **в любом случае**

> `result` — это просто имя аргумента, ты можешь использовать любое имя (например, `value`, `data`, `res`).

---

## 🔹 Цепочка промисов

```js
new Promise(resolve => resolve(2))
  .then(val => {
    console.log(val);     // 2
    return val * 2;
  })
  .then(val => {
    console.log(val);     // 4
    return val * 3;
  })
  .then(val => {
    console.log(val);     // 12
  })
  .catch(err => {
    console.error(err);
  });
```

- Каждый `.then()` возвращает **новый промис**
- Ошибка в любом месте цепочки переходит в ближайший `.catch()`

---

## 🔹 Промис с задержкой

```js
const delayed = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("Прошло 2 секунды");
  }, 2000);
});

delayed.then(msg => console.log(msg));
```

---

## 🔹 Промисы + fetch

```js
fetch("https://api.example.com/data")
  .then(response => response.json())
  .then(data => console.log("Данные:", data))
  .catch(error => console.error("Ошибка:", error))
  .finally(() => console.log("Запрос завершён"));
```

---

## 🔹 Сравнение методов

| Метод        | Описание                            |
|--------------|-------------------------------------|
| `then()`     | Обработка результата (`resolve`)    |
| `catch()`    | Обработка ошибки (`reject`)         |
| `finally()`  | Выполняется всегда, без аргументов  |

---

## 🧠 Важно запомнить

- Промис создаётся через `new Promise((resolve, reject) => {...})`
- `resolve` и `reject` вызываются вручную внутри асинхронной операции
- `.then()` подписывается на успех, `.catch()` — на ошибку
- `.finally()` вызывается в любом случае, но **не получает аргументов**
- `.then()` всегда возвращает **новый промис**

---

## ✅ Итог

- 🔄 Промис — это «обещание» получить результат позже
- 🧠 Он может быть в 3 состояниях: `pending`, `fulfilled`, `rejected`
- 💡 Методы: `then`, `catch`, `finally`
- 🔗 Позволяет строить читаемые цепочки действий
- 🚀 Основа для `fetch`, `async/await`, обработки API и данных

> 📌 Промисы — фундамент современной асинхронности в JavaScript!